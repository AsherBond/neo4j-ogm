= Changes

== 3.2.26

* [new-feature] Add support for read-only-properties. (#786)
* [tests] Demonstrate correct equals/hashCode for `@RelationshipEntity`. (#868)
* [dependencies] Update to Classgraph 4.8.116. (#886)
* [bug] Use `EnterpriseGraphDatabaseFactory` if available. (#883)
* [improvement] Add Java modules names for native types.

== 3.2.25

* [bug] Fix possible `NullpointerException`. (#880)
* [bug] Use a more unique bookmark separator. (#882)
* [dependencies] Upgrade Neo4j 3.5 to 3.5.29.

== 3.2.24

* [dependencies] Update Neo4j Java driver to 4.0.3.
* [dependencies] Upgrade Http Core to 4.4.14.
* [dependencies] Upgrade Http Client to 4.5.13.
* [improvement] Ensure compatibility with Neo4j 4.3 (only applicable for the Bolt transport when using a 4.1+ driver).
* [bug] Properly default to OUTGOING relationship.

== 3.2.23

* [improvement] Avoid using LinkedList in MappingContext.
* [bug] Use all available types when retrieving polymorphic mapped relationships. (#875)
* [dependencies] Upgrade Neo4j 3.5 to 3.5.28.

== 3.2.22

* [bug] Check if properties belong to the same entity but different relationships. (#851)
* [improvement] Support `@Properties`-annotated fields in custom query results via SingleUseEntityMapper. (#873)
* [dependencies] Upgrade Neo4j 3.5 to 3.5.27.

== 3.2.21

* [bug] Close Driver if verifyConnectivity fails to avoid resource leak. (#869)

== 3.2.20

* [improvement] Make OGM aware of org.springframework.data.annotation.Transient. (#866)
* [dependencies] Upgrade Neo4j 3.5 to 3.5.26.

== 3.2.19

* [improvement] Add shims for GraalVM native image. (#863)

== 3.2.18

* [bug] Make consistent use of mayBeReadWrite for deciding to clear the session or not. (#860)
* [improvement] Cache field information for relationship fields. (#849)
* [improvement] Cache start and endnode field info for ClassInfo instances describing relationship entities. (#852)
* [improvement] Cache relationship type. (#853)
* [improvement] Avoid recursive traversal for computing events. (#854)
* [improvement] Allow reusable test containers. (#858)
* [dependencies] Update JUnit to 4.13.1.
* [dependencies] Upgrade Neo4j 3.5 to 3.5.23.

== 3.2.17

* [bug] Fix determination of target graph property type. (#846)
* [improvement] Log query notifications in Bolt transport. (#847)

== 3.2.16

* [bug] Convert collection based parameters for filters individually. (#829)
* [bug] Avoid early population of externally generated ID fields. (#831)
* [bug] Ignore duplicates in constraint definitions. (#836)
* [improvement] Update Neo4j 3.5 to 3.5.21.
* [improvement] Precompute hashCode of MappedRelationship. (#838)
* [improvement] Compile pattern in case-insensitive mode. (#840)
* [improvement] Change log level to debug for message about potentially write queries.
* [new-feature] Check for a read only query hint. (#839)

== 3.2.15

* [bug] Ensure accessibility of annotation values. (#827)
* [bug] Unify nested query building for relationship centric queries. (#825)
* [bug] Solve ambiguous class name collision. (#809)
* [improvement] Flatten result lists as late as possible. (#826)
* [improvement] Flush mapping context on potentially write queries, buth custom and generic. (#818)
* [tests] Add an example for Kotlins inline classes. (#823)
* [tests] Prove that nested adhoc mapping from maps work. (#814)

== 3.2.14

* Relationships incoming from an inheritance tree are not deleted. (#806)

== 3.2.13

* GH-799, GH-800: Improve nested filtering: Nested filters will now always collapse when they target the same leaf node. This allows for using logical `OR` inside nested filters. We also make sure that in all scenarios, in which semantically wrong Cypher would be created, an `UnsupportedOperationException` is thrown, regardless if one tries to combined `NestedFilterOrOtherFilter` or `OtherFilterOrNestedFilter`. This may affect some derived finder methods in Spring Data Neo4j.
* GH-803: Introduce some heuristics for mapping result lists to generic fields whose types have been erased.
* Dependency upgrades
** Neo4j 3.4.18 and 3.5.19
** Neo4j Java Driver 4.0.2

== 3.2.12

* GH-793 - Fix reading of Neo4j literal byte[] arrays.
* Prepare tests for Neo4j 4.1

== 3.2.11

* Update ClassGraph to 4.8.72.
* Upgrade Neo4j 3.5 to 3.5.17.
* Support advanced Neo4j URL schemes (`bolt+s`, `bolt+ssc`, `neo4j+s`, `neo4j+ssc`). (#775)
* Enhance Pre- and PostSave events to include the saved object's state. (#778)
* Add additional tests for SingleUseEntityMapper. (#779)
* Prevent NPE when 1:n relationships contains null elements. (#782)
* Use converter for id based loading. (#787)
* Treat composite keys correct during load and save operations. (#790)

== 3.2.10

* Update Java Driver to 4.0.1.
* Update Neo4j 3.5 to 3.5.16.
* Add zoneId to `@DateString`. (#773)
* IgnoreCase filter support for starts/ends with.
* Kotlin support: Add String.asParam(). (#769)

== 3.2.9

* Update to latest version of HttpClient and Core. (#754)
* Ignore existing full text indexes when using the auto index manager. (#760)
* Support `@DateString` on `java.time.Instant` attributes. (#761)
* Update to latest Classgraph, improving memory usage in low-memory environments. (#762)
* Return correct nullable references from Kotlin extension methods. (#765)
* Fix inconsistent behaviour of Driver.unwrap(). (#767)
* Explicitly use ISO based date- and timeformatters. (#768)

WARNING: The Kotlin extension methods `Session.load(id: Serializable, depth: Int = 1)`,
         `Session.queryForObject(cypher: String, parameters: Map<String, Any> = emptyMap())` and
         `SessionFactory.unwrap()` now return nullable references to be compatible with the actual
         Java methods. This is a breaking change but avoids `IllegalStateException` during runtime.
         Please see #765 for a discussion.
         `Driver.unwrap()` will no return `null` as long as the driver hasn't been used or has not been
         initialised through `verifyConnection(true)` on the configuration.

Thanks to our reporters and contributors @emptyfruit, @aslakagens and @TWiStErRob and also @lukehutch for your input.

== 3.2.8

* Add explicit support for AttributeConverter used in Spring Data 
  `@QueryResult`-classes in SingleEntityMapper. (#752)

== 3.2.7

* Return relationship and nodes with unknown relationship types. (#737)
* Fix optimistic locking for relationship entities. (#746)
* Fix return type for known entity classes in case of an empty result. (#748)

== 3.2.6

* Improve performance of fully qualified class name lookup. (#738)
* Make OGM more resilient against scanning the root package. (#686)
* Fix IllegalArgumentException on first reload with Spring Boot DevTools. (#743)
* Avoid possible NPEs with bad domain model. (#741)
* Make database configurable. (#744)

== 3.2.5

* Return unmapped relationship models. (#727)
* Don't rely on simple class names for entity mapping. (#726)
* Improve class loading mechanism. (#729, #728)

== 3.2.4

* Pass depth parameter correctly from Kotlin session extension. (#724)
* Upgrade Java driver to 4.0.0. (#720)
* Recursively traverse variable length relationship patterns. (#718)
* Fix inconsistent behaviour when querying parent classes. (#670)
* Check for contradicting annotations before mapping possible related nodes. (#666)
* Use all mapped labels when querying domain objects. (#651)
* Verify update of relationship entities. (#607)
* Use fully qualified name to find class info. (#552)
* Make SingleUseEntityMapper aware of nested objects
  and Ensure that id fields are mapped correctly during adhoc mapping. (#551)
* Fix lookup of inner, static classes. (#391)

== 3.2.3

* Update Java driver to latest 4.0.0-rc1 release. (#699)
* Optimize scanning and storage of Node- and RelationshipEntities. (#678)
* Add support for Kotlinâ€™s "implementation by delegation". (#685)
* Improve class hierarchy of programmatic filter mechanism. (#345)
* Deprecate various utility methods (#692, #693)
* Fix possible NPE in IdentityMap. (#684)
* Fix resolving of type descriptor in Kotlin collections. (#696)
* Fix deletion of bidirectional, undirected relationships. (#657)
* Fix field lookups in class infos and improve scanning algorithm. (#704)
* Fix detection of generic 1:1 relationships. (#706)
* Upgrade Neo4j 3.5 to 3.5.13.
* Upgrade Neo4j 3.4 to 3.4.17.

== 3.2.2

* MappingException in Session.queryForObject when actualType extends objectType. (#671)

== 3.2.1

* Fix API compatibility issues with Spring Data Neo4j 5.1.x series.

== 3.2.0

* Removed "neo4j.ha.properties.file" property from OGM configuration. Use "neo4j.conf.location" instead.
* Removed `org.neo4j.ogm.autoindex.AutoIndexManager#build`. Use `org.neo4j.ogm.autoindex.AutoIndexManager#run` instead.
* Removed deprecated and unsupported method `org.neo4j.ogm.session.Neo4jSession#setDriver`.
* Removed deprecated `@GraphId`. Please use a `Long` field annotated with `@Id @GeneratedValue` instead.
* Removed deprecated `org.neo4j.ogm.session.Session.doInTransaction(GraphCallback<T>)`. SDN doesn't use that from 5.1.4
  upwards anymore.
* Allow configuration of packages to scan in `ogm.properties` through `base-packages`. (#131)
* Removed deprecated and unused ServiceNotFoundException for good this time. (#319)
* Removed deprecated `org.neo4j.ogm.session.Neo4jException`. (#319)
* Removed deprecated `org.neo4j.ogm.exception.core.NotFoundException`. (#319)
* Removed deprecated `org.neo4j.ogm.exception.core.ResultErrorsException`. (#319)
* Introduced exception translator to unify exceptions of different transports into an OGM hierarchy. (#319)
* Improved hashing in IdentityMap and MappedRelationship. (#579)
* Deprecated OgmPluginInitializer.
* Don't deploy `org.neo4j:neo4j-ogm-test` any longer. This module and the included utilities is not meant to be used outside Neo4j-OGM.
* `SessionFactory.getDriver()` has been replaced with `SessionFactory.unwrap(Class<T> clazz)` which provides a consistent
  way to get the underlying Neo4j-OGM driver or the native driver.
* Wrap CypherModificationProvider in a ThreadLocal.
* Add support for containing filter in combination with ignore case.
* Provide transformEnumKeysWith on @Properties. (#634)
* Fix unstable sort order for some queries. (#368)
* Make sure all kinds of enums are correctly identified. (#643)
* Store visited nodes under their native graph id if possible. (#640)
* Fix merging of collections. (#641)
* Use cast instead of dynamic invocation for enum map keys. (#638)
* Use concurrent hash maps as cache for entity access.
* Improve support for Kotlin data classes. (#653)
* Update Java driver to latest 4.0.0-beta02 release.
* Add some useful Kotlin extensions to Session. (#661)
